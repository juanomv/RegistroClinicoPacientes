{"ast":null,"code":"\"use strict\";\n\nvar encode = require('./encode');\n\nvar calculateEC = require('./errorcode');\n\nvar matrix = require('./matrix');\n\nfunction _deepCopy(obj) {\n  return JSON.parse(JSON.stringify(obj));\n}\n\nvar EC_LEVELS = ['L', 'M', 'Q', 'H']; // {{{1 Versions\n\nvar versions = [[], // there is no version 0\n// total number of codewords, (number of ec codewords, number of blocks) * ( L, M, Q, H )\n[26, 7, 1, 10, 1, 13, 1, 17, 1], [44, 10, 1, 16, 1, 22, 1, 28, 1], [70, 15, 1, 26, 1, 36, 2, 44, 2], [100, 20, 1, 36, 2, 52, 2, 64, 4], [134, 26, 1, 48, 2, 72, 4, 88, 4], // 5\n[172, 36, 2, 64, 4, 96, 4, 112, 4], [196, 40, 2, 72, 4, 108, 6, 130, 5], [242, 48, 2, 88, 4, 132, 6, 156, 6], [292, 60, 2, 110, 5, 160, 8, 192, 8], [346, 72, 4, 130, 5, 192, 8, 224, 8], // 10\n[404, 80, 4, 150, 5, 224, 8, 264, 11], [466, 96, 4, 176, 8, 260, 10, 308, 11], [532, 104, 4, 198, 9, 288, 12, 352, 16], [581, 120, 4, 216, 9, 320, 16, 384, 16], [655, 132, 6, 240, 10, 360, 12, 432, 18], // 15\n[733, 144, 6, 280, 10, 408, 17, 480, 16], [815, 168, 6, 308, 11, 448, 16, 532, 19], [901, 180, 6, 338, 13, 504, 18, 588, 21], [991, 196, 7, 364, 14, 546, 21, 650, 25], [1085, 224, 8, 416, 16, 600, 20, 700, 25], // 20\n[1156, 224, 8, 442, 17, 644, 23, 750, 25], [1258, 252, 9, 476, 17, 690, 23, 816, 34], [1364, 270, 9, 504, 18, 750, 25, 900, 30], [1474, 300, 10, 560, 20, 810, 27, 960, 32], [1588, 312, 12, 588, 21, 870, 29, 1050, 35], // 25\n[1706, 336, 12, 644, 23, 952, 34, 1110, 37], [1828, 360, 12, 700, 25, 1020, 34, 1200, 40], [1921, 390, 13, 728, 26, 1050, 35, 1260, 42], [2051, 420, 14, 784, 28, 1140, 38, 1350, 45], [2185, 450, 15, 812, 29, 1200, 40, 1440, 48], // 30\n[2323, 480, 16, 868, 31, 1290, 43, 1530, 51], [2465, 510, 17, 924, 33, 1350, 45, 1620, 54], [2611, 540, 18, 980, 35, 1440, 48, 1710, 57], [2761, 570, 19, 1036, 37, 1530, 51, 1800, 60], [2876, 570, 19, 1064, 38, 1590, 53, 1890, 63], // 35\n[3034, 600, 20, 1120, 40, 1680, 56, 1980, 66], [3196, 630, 21, 1204, 43, 1770, 59, 2100, 70], [3362, 660, 22, 1260, 45, 1860, 62, 2220, 74], [3532, 720, 24, 1316, 47, 1950, 65, 2310, 77], [3706, 750, 25, 1372, 49, 2040, 68, 2430, 81] // 40\n];\nversions = versions.map(function (v, index) {\n  if (!index) return {};\n  var res = {};\n\n  for (var i = 1; i < 8; i += 2) {\n    var length = v[0] - v[i];\n    var num_template = v[i + 1];\n    var ec_level = EC_LEVELS[i / 2 | 0];\n    var level = {\n      version: index,\n      ec_level: ec_level,\n      data_len: length,\n      ec_len: v[i] / num_template,\n      blocks: [],\n      ec: []\n    };\n\n    for (var k = num_template, n = length; k > 0; k--) {\n      var block = n / k | 0;\n      level.blocks.push(block);\n      n -= block;\n    }\n\n    res[ec_level] = level;\n  }\n\n  return res;\n}); // {{{1 Get version template\n\nfunction getTemplate(message, ec_level) {\n  var i = 1;\n  var len;\n\n  if (message.data1) {\n    len = Math.ceil(message.data1.length / 8);\n  } else {\n    i = 10;\n  }\n\n  for (; i < 10; i++) {\n    var version = versions[i][ec_level];\n\n    if (version.data_len >= len) {\n      return _deepCopy(version);\n    }\n  }\n\n  if (message.data10) {\n    len = Math.ceil(message.data10.length / 8);\n  } else {\n    i = 27;\n  }\n\n  for (; i < 27; i++) {\n    var version = versions[i][ec_level];\n\n    if (version.data_len >= len) {\n      return _deepCopy(version);\n    }\n  }\n\n  len = Math.ceil(message.data27.length / 8);\n\n  for (; i < 41; i++) {\n    var version = versions[i][ec_level];\n\n    if (version.data_len >= len) {\n      return _deepCopy(version);\n    }\n  }\n\n  throw new Error(\"Too much data\");\n} // {{{1 Fill template\n\n\nfunction fillTemplate(message, template) {\n  var blocks = new Buffer.alloc(template.data_len);\n  blocks.fill(0);\n\n  if (template.version < 10) {\n    message = message.data1;\n  } else if (template.version < 27) {\n    message = message.data10;\n  } else {\n    message = message.data27;\n  }\n\n  var len = message.length;\n\n  for (var i = 0; i < len; i += 8) {\n    var b = 0;\n\n    for (var j = 0; j < 8; j++) {\n      b = b << 1 | (message[i + j] ? 1 : 0);\n    }\n\n    blocks[i / 8] = b;\n  }\n\n  var pad = 236;\n\n  for (var i = Math.ceil((len + 4) / 8); i < blocks.length; i++) {\n    blocks[i] = pad;\n    pad = pad == 236 ? 17 : 236;\n  }\n\n  var offset = 0;\n  template.blocks = template.blocks.map(function (n) {\n    var b = blocks.slice(offset, offset + n);\n    offset += n;\n    template.ec.push(calculateEC(b, template.ec_len));\n    return b;\n  });\n  return template;\n} // {{{1 All-in-one\n\n\nfunction QR(text, ec_level, parse_url) {\n  ec_level = EC_LEVELS.indexOf(ec_level) > -1 ? ec_level : 'M';\n  var message = encode(text, parse_url);\n  var data = fillTemplate(message, getTemplate(message, ec_level));\n  return matrix.getMatrix(data);\n} // {{{1 export functions\n\n\nmodule.exports = {\n  QR: QR,\n  getTemplate: getTemplate,\n  fillTemplate: fillTemplate\n};","map":{"version":3,"sources":["/home/juano/reactProjects/qr_guillo (copia)/node_modules/qr-image-color/lib/qr-base.js"],"names":["encode","require","calculateEC","matrix","_deepCopy","obj","JSON","parse","stringify","EC_LEVELS","versions","map","v","index","res","i","length","num_template","ec_level","level","version","data_len","ec_len","blocks","ec","k","n","block","push","getTemplate","message","len","data1","Math","ceil","data10","data27","Error","fillTemplate","template","Buffer","alloc","fill","b","j","pad","offset","slice","QR","text","parse_url","indexOf","data","getMatrix","module","exports"],"mappings":"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","sourcesContent":["\"use strict\";\r\n\r\nvar encode = require('./encode');\r\nvar calculateEC = require('./errorcode');\r\nvar matrix = require('./matrix');\r\n\r\nfunction _deepCopy(obj) {\r\n    return JSON.parse(JSON.stringify(obj));\r\n}\r\n\r\nvar EC_LEVELS = ['L', 'M', 'Q', 'H'];\r\n\r\n// {{{1 Versions\r\nvar versions = [\r\n    [], // there is no version 0\r\n    // total number of codewords, (number of ec codewords, number of blocks) * ( L, M, Q, H )\r\n    [26, 7, 1, 10, 1, 13, 1, 17, 1],\r\n    [44, 10, 1, 16, 1, 22, 1, 28, 1],\r\n    [70, 15, 1, 26, 1, 36, 2, 44, 2],\r\n    [100, 20, 1, 36, 2, 52, 2, 64, 4],\r\n    [134, 26, 1, 48, 2, 72, 4, 88, 4], // 5\r\n    [172, 36, 2, 64, 4, 96, 4, 112, 4],\r\n    [196, 40, 2, 72, 4, 108, 6, 130, 5],\r\n    [242, 48, 2, 88, 4, 132, 6, 156, 6],\r\n    [292, 60, 2, 110, 5, 160, 8, 192, 8],\r\n    [346, 72, 4, 130, 5, 192, 8, 224, 8], // 10\r\n    [404, 80, 4, 150, 5, 224, 8, 264, 11],\r\n    [466, 96, 4, 176, 8, 260, 10, 308, 11],\r\n    [532, 104, 4, 198, 9, 288, 12, 352, 16],\r\n    [581, 120, 4, 216, 9, 320, 16, 384, 16],\r\n    [655, 132, 6, 240, 10, 360, 12, 432, 18], // 15\r\n    [733, 144, 6, 280, 10, 408, 17, 480, 16],\r\n    [815, 168, 6, 308, 11, 448, 16, 532, 19],\r\n    [901, 180, 6, 338, 13, 504, 18, 588, 21],\r\n    [991, 196, 7, 364, 14, 546, 21, 650, 25],\r\n    [1085, 224, 8, 416, 16, 600, 20, 700, 25], // 20\r\n    [1156, 224, 8, 442, 17, 644, 23, 750, 25],\r\n    [1258, 252, 9, 476, 17, 690, 23, 816, 34],\r\n    [1364, 270, 9, 504, 18, 750, 25, 900, 30],\r\n    [1474, 300, 10, 560, 20, 810, 27, 960, 32],\r\n    [1588, 312, 12, 588, 21, 870, 29, 1050, 35], // 25\r\n    [1706, 336, 12, 644, 23, 952, 34, 1110, 37],\r\n    [1828, 360, 12, 700, 25, 1020, 34, 1200, 40],\r\n    [1921, 390, 13, 728, 26, 1050, 35, 1260, 42],\r\n    [2051, 420, 14, 784, 28, 1140, 38, 1350, 45],\r\n    [2185, 450, 15, 812, 29, 1200, 40, 1440, 48], // 30\r\n    [2323, 480, 16, 868, 31, 1290, 43, 1530, 51],\r\n    [2465, 510, 17, 924, 33, 1350, 45, 1620, 54],\r\n    [2611, 540, 18, 980, 35, 1440, 48, 1710, 57],\r\n    [2761, 570, 19, 1036, 37, 1530, 51, 1800, 60],\r\n    [2876, 570, 19, 1064, 38, 1590, 53, 1890, 63], // 35\r\n    [3034, 600, 20, 1120, 40, 1680, 56, 1980, 66],\r\n    [3196, 630, 21, 1204, 43, 1770, 59, 2100, 70],\r\n    [3362, 660, 22, 1260, 45, 1860, 62, 2220, 74],\r\n    [3532, 720, 24, 1316, 47, 1950, 65, 2310, 77],\r\n    [3706, 750, 25, 1372, 49, 2040, 68, 2430, 81] // 40\r\n];\r\n\r\nversions = versions.map(function(v, index) {\r\n    if (!index) return {};\r\n\r\n    var res = {\r\n    }\r\n    for (var i = 1; i < 8; i += 2) {\r\n        var length = v[0] - v[i];\r\n        var num_template = v[i+1];\r\n        var ec_level = EC_LEVELS[(i/2)|0];\r\n        var level = {\r\n            version: index,\r\n            ec_level: ec_level,\r\n            data_len: length,\r\n            ec_len: v[i] / num_template,\r\n            blocks: [],\r\n            ec: []\r\n        }\r\n\r\n        for (var k = num_template, n = length; k > 0; k--) {\r\n            var block = (n / k)|0;\r\n            level.blocks.push(block);\r\n            n -= block;\r\n\r\n        }\r\n        res[ec_level] = level;\r\n    }\r\n    return res;\r\n});\r\n\r\n// {{{1 Get version template\r\nfunction getTemplate(message, ec_level) {\r\n    var i = 1;\r\n    var len;\r\n\r\n    if (message.data1) {\r\n        len = Math.ceil(message.data1.length / 8);\r\n    } else {\r\n        i = 10;\r\n    }\r\n    for (/* i */; i < 10; i++) {\r\n        var version = versions[i][ec_level];\r\n        if (version.data_len >= len) {\r\n            return _deepCopy(version);\r\n        }\r\n    }\r\n\r\n    if (message.data10) {\r\n        len = Math.ceil(message.data10.length / 8);\r\n    } else {\r\n        i = 27;\r\n    }\r\n    for (/* i */; i < 27; i++) {\r\n        var version = versions[i][ec_level];\r\n        if (version.data_len >= len) {\r\n            return _deepCopy(version);\r\n        }\r\n    }\r\n\r\n    len = Math.ceil(message.data27.length / 8);\r\n    for (/* i */; i < 41; i++) {\r\n        var version = versions[i][ec_level];\r\n        if (version.data_len >= len) {\r\n            return _deepCopy(version);\r\n        }\r\n    }\r\n    throw new Error(\"Too much data\");\r\n}\r\n\r\n// {{{1 Fill template\r\nfunction fillTemplate(message, template) {\r\n    var blocks = new Buffer.alloc(template.data_len);\r\n    blocks.fill(0);\r\n\r\n    if (template.version < 10) {\r\n        message = message.data1;\r\n    } else if (template.version < 27) {\r\n        message = message.data10;\r\n    } else {\r\n        message = message.data27;\r\n    }\r\n\r\n    var len = message.length;\r\n\r\n    for (var i = 0; i < len; i += 8) {\r\n        var b = 0;\r\n        for (var j = 0; j < 8; j++) {\r\n            b = (b << 1) | (message[i + j] ? 1 : 0);\r\n        }\r\n        blocks[i / 8] = b;\r\n    }\r\n\r\n    var pad = 236;\r\n    for (var i = Math.ceil((len + 4) / 8); i < blocks.length; i++) {\r\n        blocks[i] = pad;\r\n        pad = (pad == 236) ? 17 : 236;\r\n    }\r\n\r\n    var offset = 0;\r\n    template.blocks = template.blocks.map(function(n) {\r\n        var b = blocks.slice(offset, offset + n);\r\n        offset += n;\r\n        template.ec.push(calculateEC(b, template.ec_len));\r\n        return b;\r\n    });\r\n\r\n    return template;\r\n}\r\n\r\n// {{{1 All-in-one\r\nfunction QR(text, ec_level, parse_url) {\r\n    ec_level = EC_LEVELS.indexOf(ec_level) > -1 ? ec_level : 'M';\r\n    var message = encode(text, parse_url);\r\n    var data = fillTemplate(message, getTemplate(message, ec_level));\r\n    return matrix.getMatrix(data);\r\n}\r\n\r\n// {{{1 export functions\r\nmodule.exports = {\r\n    QR: QR,\r\n    getTemplate: getTemplate,\r\n    fillTemplate: fillTemplate,\r\n}\r\n"]},"metadata":{},"sourceType":"script"}