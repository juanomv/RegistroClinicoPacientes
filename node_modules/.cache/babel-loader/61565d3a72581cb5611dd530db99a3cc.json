{"ast":null,"code":"import _regeneratorRuntime from\"/home/juano/reactProjects/Novo-Lab-Clinico/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/juano/reactProjects/Novo-Lab-Clinico/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/juano/reactProjects/Novo-Lab-Clinico/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import Select from\"react-select\";import axios from\"axios\";import app from\"../firebase.config\";import{getStorage,ref,uploadBytes,getDownloadURL,deleteObject}from\"firebase/storage\";import{headers,Url as lru}from\"../config\";import Loading from\"./Loading\";import Check from\"./Check\";import moment from\"moment\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var AddRegistro=function AddRegistro(_ref){var reload=_ref.reload,salir=_ref.salir,accion=_ref.accion,valores=_ref.valores;var storage=getStorage(app);var _useState=useState([]),_useState2=_slicedToArray(_useState,2),pacientes=_useState2[0],setPacientes=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),examenes=_useState4[0],setExamenes=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var _useState7=useState({ExaName:null,Examen:null,Fecha:null,Id:null,Nombre:null,Paciente:null,url:null}),_useState8=_slicedToArray(_useState7,2),Update=_useState8[0],setUpdate=_useState8[1];var _useState9=useState({Examen:null,Paciente:null,Url:null,Fecha:null}),_useState10=_slicedToArray(_useState9,2),data=_useState10[0],setData=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),file=_useState12[0],setFile=_useState12[1];var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),errorExamen=_useState14[0],setErrorExamen=_useState14[1];var _useState15=useState(null),_useState16=_slicedToArray(_useState15,2),errorPaciente=_useState16[0],setErrorPaciente=_useState16[1];var _useState17=useState(null),_useState18=_slicedToArray(_useState17,2),errorUrl=_useState18[0],setErrorUrl=_useState18[1];var _useState19=useState(null),_useState20=_slicedToArray(_useState19,2),errorFecha=_useState20[0],setErrorFecha=_useState20[1];headers.Authorization=\"Bearer \"+localStorage.getItem(\"Token\");useEffect(function(){axios.get(lru+\"Registro/GetAll\",{headers:headers}).then(function(res){if(res.data.code==='CAD01'){salir();reload();}setPacientes(res.data.Paciente);setExamenes(res.data.Examen);}).catch(function(error){return console.log(error);});if(data.Url)setFile(true);if(accion===\"Update\"){data.Examen=valores.Examen;data.Paciente=valores.Paciente;data.Url=valores.url;data.Fecha=formatDate(valores.Fecha);setData(data);for(var key in valores){Update[key]=valores[key];}Update.Fecha=formatDate(valores.Fecha);setUpdate(Update);}else{Update.Fecha=formatDate(new Date());setUpdate(Update);data.Fecha=formatDate(new Date());setData(data);}},[]);function formatDate(date){moment.locale('en');return moment(date).format('YYYY-MM-DD');}var handleChange=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var desertRef,pdf,minuto,seconds,sec,archivo,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();if(data.Url){setFile(false);desertRef=ref(storage,data.Url);deleteObject(desertRef).then(function(){data.Url=null;setData(data);}).catch(function(error){console.log(error);});}pdf=e.target.files[0];if(!pdf){_context.next=22;break;}minuto=new Date().getMinutes();seconds=new Date().getMilliseconds();sec=new Date().getSeconds();archivo=ref(storage,\"documentos/\".concat(pdf.name.split(\".pdf\")[0],\"-\").concat(seconds,\"-\").concat(minuto,\"-\").concat(sec,\".pdf\"));_context.prev=8;_context.next=11;return uploadBytes(archivo,pdf);case 11:_context.next=13;return getDownloadURL(archivo);case 13:res=_context.sent;data.Url=res;setData(data);setFile(true);_context.next=22;break;case 19:_context.prev=19;_context.t0=_context[\"catch\"](8);console.log(_context.t0);case 22:setErrorUrl(null);case 23:case\"end\":return _context.stop();}}},_callee,null,[[8,19]]);}));return function handleChange(_x){return _ref2.apply(this,arguments);};}();var addRegistro=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var subir,key,res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!data.Paciente)setErrorPaciente(\"el Paciente es obligatorio\");if(!data.Examen)setErrorExamen(\"el Examen obligatorio\");if(!data.Fecha)setErrorFecha(\"Fecha obligatorio\");if(!data.Url)setErrorUrl(\"Debe subir un Documento\");subir=true;for(key in data){if(!data[key])subir=false;}if(!subir){_context2.next=20;break;}setLoading(true);if(!(accion=='New')){_context2.next=14;break;}_context2.next=11;return axios.post(lru+\"Registro/New\",data,{headers:headers});case 11:res=_context2.sent;_context2.next=19;break;case 14:if(!(accion=='Update')){_context2.next=19;break;}data.Id=Update.Id;_context2.next=18;return axios.put(lru+\"Registro/Update\",data,{headers:headers});case 18:res=_context2.sent;case 19:if(res.data.ok){setTimeout(function(){setLoading(false);},500);salir();reload();}case 20:case\"end\":return _context2.stop();}}},_callee2);}));return function addRegistro(){return _ref3.apply(this,arguments);};}();var handleChangeD=function handleChangeD(param){return function(e){if(param!==\"Fecha\")data[param]=e.value;else data[param]=e.target.value;setData(data);switch(param){case\"Paciente\":setErrorPaciente(null);break;case\"Examen\":setErrorExamen(null);break;case\"Fecha\":setErrorFecha(null);break;default:break;}};};var switchPaciente=function switchPaciente(){switch(accion){case'Update':return/*#__PURE__*/_jsx(Select,{id:\"Paciente\",options:pacientes,defaultValue:{value:valores.Paciente,label:valores.Paciente+\" - \"+valores.Nombre},onChange:handleChangeD(\"Paciente\")});default:return/*#__PURE__*/_jsx(Select,{id:\"Paciente\",options:pacientes,onChange:handleChangeD(\"Paciente\")});}};var switchExamen=function switchExamen(){switch(accion){case'Update':return/*#__PURE__*/_jsx(Select,{id:\"Examen\",options:examenes,defaultValue:{value:valores.Examen,label:valores.ExaName},onChange:handleChangeD(\"Examen\")});default:return/*#__PURE__*/_jsx(Select,{id:\"Examen\",options:examenes,onChange:handleChangeD(\"Examen\")});}};return/*#__PURE__*/_jsxs(\"form\",{className:\"flex flex-col  bg-white w-auto p-4 justify-between \",children:[loading&&/*#__PURE__*/_jsx(Loading,{}),/*#__PURE__*/_jsx(\"label\",{className:\"mt-4 mb-1\",htmlFor:\"Paciente\",children:\"Paciente\"}),!loading&&switchPaciente(),/*#__PURE__*/_jsx(\"span\",{className:\"Warring\",children:errorPaciente&&errorPaciente}),/*#__PURE__*/_jsx(\"label\",{className:\"mt-4 mb-1\",htmlFor:\"Examen\",children:\"Examen\"}),!loading&&switchExamen(),/*#__PURE__*/_jsx(\"span\",{className:\"Warring\",children:errorExamen&&errorExamen}),/*#__PURE__*/_jsx(\"label\",{className:\"mt-4 mb-1\",htmlFor:\"Archivo\",children:\"Subir Pdf\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-row justify-between\",children:[/*#__PURE__*/_jsx(\"input\",{onChange:handleChange,type:\"file\",name:\"Archivo\",id:\"Archivo\",accept:\"application/pdf \"}),!file?/*#__PURE__*/_jsx(Check,{size:5,color:\"gray\"}):/*#__PURE__*/_jsx(Check,{size:5,color:\"green\"})]}),/*#__PURE__*/_jsx(\"span\",{className:\"Warring\",children:errorUrl&&errorUrl}),/*#__PURE__*/_jsx(\"label\",{className:\"mt-4 mb-1\",htmlFor:\"Fecha\",children:\"Fecha\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",name:\"Fecha\",id:\"Fecha\",defaultValue:Update.Fecha,onChange:handleChangeD(\"Fecha\")}),/*#__PURE__*/_jsx(\"span\",{className:\"Warring\",children:errorFecha&&errorFecha}),/*#__PURE__*/_jsx(\"input\",{onClick:function onClick(){return addRegistro();},className:\"w-2/3 my-6 ml-16\",type:\"button\",value:\"Agregar\"})]});};export default AddRegistro;","map":{"version":3,"sources":["/home/juano/reactProjects/Novo-Lab-Clinico/src/componets/AddRegistro.jsx"],"names":["React","useEffect","useState","Select","axios","app","getStorage","ref","uploadBytes","getDownloadURL","deleteObject","headers","Url","lru","Loading","Check","moment","AddRegistro","reload","salir","accion","valores","storage","pacientes","setPacientes","examenes","setExamenes","loading","setLoading","ExaName","Examen","Fecha","Id","Nombre","Paciente","url","Update","setUpdate","data","setData","file","setFile","errorExamen","setErrorExamen","errorPaciente","setErrorPaciente","errorUrl","setErrorUrl","errorFecha","setErrorFecha","Authorization","localStorage","getItem","get","then","res","code","catch","error","console","log","formatDate","key","Date","date","locale","format","handleChange","e","preventDefault","desertRef","pdf","target","files","minuto","getMinutes","seconds","getMilliseconds","sec","getSeconds","archivo","name","split","addRegistro","subir","post","put","ok","setTimeout","handleChangeD","param","value","switchPaciente","label","switchExamen"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport Select from \"react-select\";\nimport axios from \"axios\";\nimport app from \"../firebase.config\";\nimport {\n  getStorage,\n  ref,\n  uploadBytes,\n  getDownloadURL,\n  deleteObject,\n} from \"firebase/storage\";\nimport { headers, Url as lru } from \"../config\";\nimport Loading from \"./Loading\";\nimport Check from \"./Check\";\nimport moment from \"moment\";\n\nconst AddRegistro = ({reload,salir,accion, valores}) => {\n  \n  const storage = getStorage(app);\n  const [pacientes, setPacientes] = useState([]);\n  const [examenes, setExamenes] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [Update, setUpdate] = useState({ExaName: null , Examen:  null,Fecha: null , Id:  null, Nombre:  null, Paciente:  null, url:  null});\n  const [data, setData] = useState({\n    Examen: null,\n    Paciente: null,\n    Url: null,\n    Fecha: null,\n  });\n  const [file, setFile] = useState(false);\n  const [errorExamen, setErrorExamen] = useState(null);\n  const [errorPaciente, setErrorPaciente] = useState(null);\n  const [errorUrl, setErrorUrl] = useState(null);\n  const [errorFecha, setErrorFecha] = useState(null);\n  \n  headers.Authorization = \"Bearer \" + localStorage.getItem(\"Token\");\n  useEffect(() => {\n    axios\n      .get(lru + \"Registro/GetAll\", { headers })\n      .then((res) => {\n        \n        if(res.data.code==='CAD01')  {salir();reload()}\n        setPacientes(res.data.Paciente);\n        setExamenes(res.data.Examen);\n      })\n      .catch((error) => console.log(error));\n    if (data.Url) setFile(true);\n    \n    if (accion === \"Update\") {\n      data.Examen=valores.Examen\n      data.Paciente=valores.Paciente\n      data.Url=valores.url\n      data.Fecha=formatDate(valores.Fecha)\n      setData(data)\n      \n      for (const key in valores) {\n        Update[key]=valores[key]\n      }\n      Update.Fecha=formatDate(valores.Fecha)\n      setUpdate(Update);\n     \n\n    }else{ Update.Fecha = formatDate(new Date()); setUpdate(Update);data.Fecha=formatDate(new Date());setData(data)}\n  }, []);\n\n  function formatDate(date){\n    moment.locale('en');\n      \n      return(moment(date).format('YYYY-MM-DD'))\n  }\n  const handleChange = async (e) => {\n    e.preventDefault();\n    if (data.Url) {\n      setFile(false);\n      \n      const desertRef = ref(storage, data.Url);\n      deleteObject(desertRef)\n        .then(() => {\n          data.Url = null;\n          setData(data);\n        })\n        .catch((error) => {\n          console.log(error);\n        });\n    }\n\n    let pdf = e.target.files[0];\n  \n    if (pdf) {\n      const minuto = new Date().getMinutes();\n      const seconds = new Date().getMilliseconds();\n      const sec = new Date().getSeconds();\n      const archivo = ref(\n        storage,\n        `documentos/${\n          pdf.name.split(\".pdf\")[0]\n        }-${seconds}-${minuto}-${sec}.pdf`\n      );\n      \n      try {\n        await uploadBytes(archivo, pdf);\n        const res = await getDownloadURL(archivo);\n        data.Url = res;\n        \n        setData(data);\n        setFile(true);\n      } catch (error) {\n        console.log(error)\n      }\n    }\n\n    setErrorUrl(null);\n  };\n\n  const addRegistro = async () => {\n    if (!data.Paciente) setErrorPaciente(\"el Paciente es obligatorio\");\n    if (!data.Examen) setErrorExamen(\"el Examen obligatorio\");\n    if (!data.Fecha) setErrorFecha(\"Fecha obligatorio\");\n    if (!data.Url) setErrorUrl(\"Debe subir un Documento\");\n\n    \n    let subir = true;\n    for (const key in data) {\n      if (!data[key]) subir = false;\n    }\n    if (subir) {\n      setLoading(true);\n      let res;\n      \n      if(accion=='New') res = await axios.post(lru + \"Registro/New\", data, { headers });\n      else if(accion=='Update'){data.Id=Update.Id ;res = await axios.put(lru + \"Registro/Update\", data, { headers })}\n     \n      if(res.data.ok){\n      setTimeout(() => {\n        setLoading(false);\n      }, 500);\n      salir();\n      reload()\n    }\n    }\n  };\n\n  const handleChangeD = (param) => (e) => {\n    if (param !== \"Fecha\") data[param] = e.value;\n    else data[param] = e.target.value;\n    setData(data);\n    switch (param) {\n      case \"Paciente\":\n        setErrorPaciente(null);\n        break;\n      case \"Examen\":\n        setErrorExamen(null);\n        break;\n      case \"Fecha\":\n        setErrorFecha(null);\n        break;\n      default:\n        break;\n    }\n   \n  };\n\n  \n\n  const switchPaciente =()=>{\n    switch (accion) {\n      case 'Update':\n        \n        return(\n          <Select\n          id=\"Paciente\"\n          options={pacientes}\n          defaultValue={{ value: valores.Paciente ,label: valores.Paciente+ \" - \" + valores.Nombre }}\n          onChange={handleChangeD(\"Paciente\")}\n        />\n        )\n        \n      default:\n        return(\n          <Select\n          id=\"Paciente\"\n          options={pacientes}\n          onChange={handleChangeD(\"Paciente\")}\n        />\n        );\n    }\n  }\n\n  const switchExamen =()=>{\n    switch (accion) {\n      case 'Update':\n        \n        return(\n          <Select\n          id=\"Examen\"\n          options={examenes}\n          defaultValue={{ value: valores.Examen ,label:  valores.ExaName }}\n          onChange={handleChangeD(\"Examen\")}\n        />\n        )\n        \n      default:\n        return(\n          <Select\n          id=\"Examen\"\n          options={examenes}\n          onChange={handleChangeD(\"Examen\")}\n        />\n        );\n    }\n  }\n  return (\n    <form className=\"flex flex-col  bg-white w-auto p-4 justify-between \">\n      {loading && <Loading />}\n      <label className=\"mt-4 mb-1\" htmlFor=\"Paciente\">\n        Paciente\n      </label>\n      {!loading && switchPaciente()}\n\n      <span className=\"Warring\">{errorPaciente && errorPaciente}</span>\n\n      <label className=\"mt-4 mb-1\" htmlFor=\"Examen\">\n        Examen\n      </label>\n      {!loading && switchExamen()}\n\n      <span className=\"Warring\">{errorExamen && errorExamen}</span>\n      <label className=\"mt-4 mb-1\" htmlFor=\"Archivo\">\n        Subir Pdf\n      </label>\n     \n      <div className=\"flex flex-row justify-between\">\n      \n        <input\n          onChange={handleChange}\n          type=\"file\"\n          name=\"Archivo\"\n          id=\"Archivo\"\n          accept=\"application/pdf \"\n        />\n        {  !file ? (\n          <Check size={5} color={\"gray\"} />\n        ) : (\n          <Check size={5} color={\"green\"} />\n        )}\n      </div>\n\n      <span className=\"Warring\">{errorUrl && errorUrl}</span>\n      <label className=\"mt-4 mb-1\" htmlFor=\"Fecha\">\n        Fecha\n      </label>\n      <input\n        type=\"date\"\n        name=\"Fecha\"\n        id=\"Fecha\"\n        defaultValue={Update.Fecha}\n        onChange={handleChangeD(\"Fecha\")}\n      />\n      <span className=\"Warring\">{errorFecha && errorFecha}</span>\n      <input\n        onClick={() => addRegistro()}\n        className=\"w-2/3 my-6 ml-16\"\n        type=\"button\"\n        value=\"Agregar\"\n      />\n    </form>\n  );\n};\n\nexport default AddRegistro;\n"]},"metadata":{},"sourceType":"module"}