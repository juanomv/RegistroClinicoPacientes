{"ast":null,"code":"var _jsxFileName = \"/home/juano/reactProjects/qr_guillo (copia)/src/componets/AddRegistro.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from \"react\";\nimport Select from \"react-select\";\nimport axios from \"axios\";\nimport app from \"../firebase.config\";\nimport { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from \"firebase/storage\";\nimport { headers, Url as lru } from \"../config\";\nimport Loading from \"./Loading\";\nimport Check from \"./Check\";\nimport moment from \"moment\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst AddRegistro = _ref => {\n  _s();\n\n  let {\n    reload,\n    salir,\n    accion,\n    valores\n  } = _ref;\n  const storage = getStorage(app);\n  const [pacientes, setPacientes] = useState([]);\n  const [examenes, setExamenes] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [Update, setUpdate] = useState({\n    ExaName: null,\n    Examen: null,\n    Fecha: null,\n    Id: null,\n    Nombre: null,\n    Paciente: null,\n    url: null\n  });\n  const [data, setData] = useState({\n    Examen: null,\n    Paciente: null,\n    Url: null,\n    Fecha: null\n  });\n  const [file, setFile] = useState(false);\n  const [errorExamen, setErrorExamen] = useState(null);\n  const [errorPaciente, setErrorPaciente] = useState(null);\n  const [errorUrl, setErrorUrl] = useState(null);\n  const [errorFecha, setErrorFecha] = useState(null);\n  headers.Authorization = \"Bearer \" + localStorage.getItem(\"Token\");\n  useEffect(() => {\n    axios.get(lru + \"Registro/GetAll\", {\n      headers\n    }).then(res => {\n      setPacientes(res.data.Paciente);\n      setExamenes(res.data.Examen);\n    }).catch(error => console.log(error));\n    if (data.Url) setFile(true);\n\n    if (accion === \"Update\") {\n      data.Examen = valores.Examen;\n      data.Paciente = valores.Paciente;\n      data.Url = valores.url;\n      data.Fecha = formatDate(valores.Fecha);\n      setData(data);\n\n      for (const key in valores) {\n        Update[key] = valores[key];\n      }\n\n      Update.Fecha = formatDate(valores.Fecha);\n      setUpdate(Update);\n      axios({\n        url: data.Url,\n        method: 'GET',\n        responseType: 'blob'\n      }).then(response => {\n        var fileURL = window.URL.createObjectURL(new Blob([response.data]));\n        console.log(fileURL); //  var fileLink = document.createElement('a');\n        //  fileLink.href = fileURL;\n        //  fileLink.setAttribute('download', 'file.pdf');\n        //  document.body.appendChild(fileLink);\n        //  fileLink.click();\n      }).catch(err => console.log(err));\n      console.log('Update ', Update);\n    }\n  }, []);\n\n  function formatDate(date) {\n    moment.locale('en');\n    return moment(date).format('YYYY-MM-DD');\n  }\n\n  const handleChange = async e => {\n    e.preventDefault();\n\n    if (data.Url) {\n      setFile(false);\n      const desertRef = ref(storage, data.Url);\n      deleteObject(desertRef).then(() => {\n        data.Url = null;\n        setData(data);\n      }).catch(error => {\n        console.log(error);\n      });\n    }\n\n    let pdf = e.target.files[0];\n\n    if (pdf) {\n      const minuto = new Date().getMinutes();\n      const seconds = new Date().getMilliseconds();\n      const sec = new Date().getSeconds();\n      const archivo = ref(storage, `documentos/${pdf.name.split(\".pdf\")[0]}-${seconds}-${minuto}-${sec}.pdf`);\n\n      try {\n        await uploadBytes(archivo, pdf);\n        const res = await getDownloadURL(archivo);\n        data.Url = res;\n        setData(data);\n        setFile(true);\n      } catch (error) {\n        console.log(error);\n      }\n    }\n\n    setErrorUrl(null);\n  };\n\n  const addRegistro = async () => {\n    if (!data.Paciente) setErrorPaciente(\"el Paciente es obligatorio\");\n    if (!data.Examen) setErrorExamen(\"el Examen obligatorio\");\n    if (!data.Fecha) setErrorFecha(\"Fecha obligatorio\");\n    if (!data.Url) setErrorUrl(\"Debe subir un Documento\");\n    let subir = true;\n\n    for (const key in data) {\n      if (!data[key]) subir = false;\n    }\n\n    if (subir) {\n      setLoading(true);\n      let res;\n      console.log('data', data);\n      if (accion == 'New') res = await axios.post(lru + \"Registro/New\", data, {\n        headers\n      });else if (accion == 'Update') {\n        data.Id = Update.Id;\n        res = await axios.post(lru + \"Registro/New\", data, {\n          headers\n        });\n      }\n      console.log(res);\n\n      if (res.data.ok) {\n        setTimeout(() => {\n          setLoading(false);\n        }, 500);\n        salir();\n        reload();\n      }\n    }\n  };\n\n  const handleChangeD = param => e => {\n    if (param !== \"Fecha\") data[param] = e.value;else data[param] = e.target.value;\n    setData(data);\n\n    switch (param) {\n      case \"Paciente\":\n        setErrorPaciente(null);\n        break;\n\n      case \"Examen\":\n        setErrorExamen(null);\n        break;\n\n      case \"Fecha\":\n        setErrorFecha(null);\n        break;\n\n      default:\n        break;\n    }\n  };\n\n  const deleteUrl = () => {\n    Update.url = null;\n    setUpdate(Update);\n  };\n\n  const switchPaciente = () => {\n    switch (accion) {\n      case 'Update':\n        return /*#__PURE__*/_jsxDEV(Select, {\n          id: \"Paciente\",\n          options: pacientes,\n          defaultValue: {\n            value: valores.Paciente,\n            label: valores.Paciente + \" - \" + valores.Nombre\n          },\n          onChange: handleChangeD(\"Paciente\")\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 11\n        }, this);\n\n      default:\n        return /*#__PURE__*/_jsxDEV(Select, {\n          id: \"Paciente\",\n          options: pacientes,\n          onChange: handleChangeD(\"Paciente\")\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 11\n        }, this);\n    }\n  };\n\n  const switchExamen = () => {\n    switch (accion) {\n      case 'Update':\n        return /*#__PURE__*/_jsxDEV(Select, {\n          id: \"Examen\",\n          options: examenes,\n          defaultValue: {\n            value: valores.Examen,\n            label: valores.ExaName\n          },\n          onChange: handleChangeD(\"Examen\")\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 11\n        }, this);\n\n      default:\n        return /*#__PURE__*/_jsxDEV(Select, {\n          id: \"Examen\",\n          options: examenes,\n          onChange: handleChangeD(\"Examen\")\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 217,\n          columnNumber: 11\n        }, this);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"form\", {\n    className: \"flex flex-col  bg-white w-auto p-4 justify-between \",\n    children: [loading && /*#__PURE__*/_jsxDEV(Loading, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 19\n    }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n      className: \"mt-4 mb-1\",\n      htmlFor: \"Paciente\",\n      children: \"Paciente\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 7\n    }, this), !loading && switchPaciente(), /*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"Warring\",\n      children: errorPaciente && errorPaciente\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n      className: \"mt-4 mb-1\",\n      htmlFor: \"Examen\",\n      children: \"Examen\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 7\n    }, this), !loading && switchExamen(), /*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"Warring\",\n      children: errorExamen && errorExamen\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 240,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n      className: \"mt-4 mb-1\",\n      htmlFor: \"Archivo\",\n      children: \"Subir Pdf\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex flex-row justify-between\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        onChange: handleChange,\n        type: \"file\",\n        name: \"Archivo\",\n        id: \"Archivo\",\n        accept: \"application/pdf \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 9\n      }, this), !file ? /*#__PURE__*/_jsxDEV(Check, {\n        size: 5,\n        color: \"gray\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 255,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(Check, {\n        size: 5,\n        color: \"green\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"Warring\",\n      children: errorUrl && errorUrl\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n      className: \"mt-4 mb-1\",\n      htmlFor: \"Fecha\",\n      children: \"Fecha\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"date\",\n      name: \"Fecha\",\n      id: \"Fecha\",\n      defaultValue: Update.Fecha,\n      onChange: handleChangeD(\"Fecha\")\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 265,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"Warring\",\n      children: errorFecha && errorFecha\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 272,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      onClick: () => addRegistro(),\n      className: \"w-2/3 my-6 ml-16\",\n      type: \"button\",\n      value: \"Agregar\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 273,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 226,\n    columnNumber: 5\n  }, this);\n};\n\n_s(AddRegistro, \"zNGPyP7iA9vLyhNCJe6IkGb001g=\");\n\n_c = AddRegistro;\nexport default AddRegistro;\n\nvar _c;\n\n$RefreshReg$(_c, \"AddRegistro\");","map":{"version":3,"sources":["/home/juano/reactProjects/qr_guillo (copia)/src/componets/AddRegistro.jsx"],"names":["React","useEffect","useState","Select","axios","app","getStorage","ref","uploadBytes","getDownloadURL","deleteObject","headers","Url","lru","Loading","Check","moment","AddRegistro","reload","salir","accion","valores","storage","pacientes","setPacientes","examenes","setExamenes","loading","setLoading","Update","setUpdate","ExaName","Examen","Fecha","Id","Nombre","Paciente","url","data","setData","file","setFile","errorExamen","setErrorExamen","errorPaciente","setErrorPaciente","errorUrl","setErrorUrl","errorFecha","setErrorFecha","Authorization","localStorage","getItem","get","then","res","catch","error","console","log","formatDate","key","method","responseType","response","fileURL","window","URL","createObjectURL","Blob","err","date","locale","format","handleChange","e","preventDefault","desertRef","pdf","target","files","minuto","Date","getMinutes","seconds","getMilliseconds","sec","getSeconds","archivo","name","split","addRegistro","subir","post","ok","setTimeout","handleChangeD","param","value","deleteUrl","switchPaciente","label","switchExamen"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport Select from \"react-select\";\nimport axios from \"axios\";\nimport app from \"../firebase.config\";\nimport {\n  getStorage,\n  ref,\n  uploadBytes,\n  getDownloadURL,\n  deleteObject,\n} from \"firebase/storage\";\nimport { headers, Url as lru } from \"../config\";\nimport Loading from \"./Loading\";\nimport Check from \"./Check\";\nimport moment from \"moment\";\n\nconst AddRegistro = ({reload,salir,accion, valores}) => {\n  const storage = getStorage(app);\n  const [pacientes, setPacientes] = useState([]);\n  const [examenes, setExamenes] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [Update, setUpdate] = useState({ExaName: null , Examen:  null,Fecha: null , Id:  null, Nombre:  null, Paciente:  null, url:  null});\n  const [data, setData] = useState({\n    Examen: null,\n    Paciente: null,\n    Url: null,\n    Fecha: null,\n  });\n  const [file, setFile] = useState(false);\n  const [errorExamen, setErrorExamen] = useState(null);\n  const [errorPaciente, setErrorPaciente] = useState(null);\n  const [errorUrl, setErrorUrl] = useState(null);\n  const [errorFecha, setErrorFecha] = useState(null);\n\n  headers.Authorization = \"Bearer \" + localStorage.getItem(\"Token\");\n  useEffect(() => {\n    axios\n      .get(lru + \"Registro/GetAll\", { headers })\n      .then((res) => {\n        setPacientes(res.data.Paciente);\n        setExamenes(res.data.Examen);\n      })\n      .catch((error) => console.log(error));\n    if (data.Url) setFile(true);\n    if (accion === \"Update\") {\n      data.Examen=valores.Examen\n      data.Paciente=valores.Paciente\n      data.Url=valores.url\n      data.Fecha=formatDate(valores.Fecha)\n      setData(data)\n      \n      for (const key in valores) {\n        Update[key]=valores[key]\n      }\n      Update.Fecha=formatDate(valores.Fecha)\n      setUpdate(Update);\n      axios({\n        url: data.Url,\n        method: 'GET',\n        responseType: 'blob',\n        }).then((response) => {\n         var fileURL = window.URL.createObjectURL(new Blob([response.data]));\n          console.log(fileURL)\n        //  var fileLink = document.createElement('a');\n      \n        //  fileLink.href = fileURL;\n        //  fileLink.setAttribute('download', 'file.pdf');\n        //  document.body.appendChild(fileLink);\n       \n        //  fileLink.click();\n    }).catch(err=>console.log(err));\n      console.log('Update ',Update)\n    }\n  }, []);\n\n  function formatDate(date){\n    moment.locale('en');\n      \n      return(moment(date).format('YYYY-MM-DD'))\n  }\n  const handleChange = async (e) => {\n    e.preventDefault();\n    if (data.Url) {\n      setFile(false);\n      \n      const desertRef = ref(storage, data.Url);\n      deleteObject(desertRef)\n        .then(() => {\n          data.Url = null;\n          setData(data);\n        })\n        .catch((error) => {\n          console.log(error);\n        });\n    }\n\n    let pdf = e.target.files[0];\n  \n    if (pdf) {\n      const minuto = new Date().getMinutes();\n      const seconds = new Date().getMilliseconds();\n      const sec = new Date().getSeconds();\n      const archivo = ref(\n        storage,\n        `documentos/${\n          pdf.name.split(\".pdf\")[0]\n        }-${seconds}-${minuto}-${sec}.pdf`\n      );\n      \n      try {\n        await uploadBytes(archivo, pdf);\n        const res = await getDownloadURL(archivo);\n        data.Url = res;\n        \n        setData(data);\n        setFile(true);\n      } catch (error) {\n        console.log(error)\n      }\n    }\n\n    setErrorUrl(null);\n  };\n\n  const addRegistro = async () => {\n    if (!data.Paciente) setErrorPaciente(\"el Paciente es obligatorio\");\n    if (!data.Examen) setErrorExamen(\"el Examen obligatorio\");\n    if (!data.Fecha) setErrorFecha(\"Fecha obligatorio\");\n    if (!data.Url) setErrorUrl(\"Debe subir un Documento\");\n\n    \n    let subir = true;\n    for (const key in data) {\n      if (!data[key]) subir = false;\n    }\n    if (subir) {\n      setLoading(true);\n      let res;\n      console.log('data', data)\n      if(accion=='New') res = await axios.post(lru + \"Registro/New\", data, { headers });\n      else if(accion=='Update'){data.Id=Update.Id ;res = await axios.post(lru + \"Registro/New\", data, { headers })}\n      console.log(res)\n      if(res.data.ok){\n      setTimeout(() => {\n        setLoading(false);\n      }, 500);\n      salir();\n      reload()\n    }\n    }\n  };\n\n  const handleChangeD = (param) => (e) => {\n    if (param !== \"Fecha\") data[param] = e.value;\n    else data[param] = e.target.value;\n    setData(data);\n    switch (param) {\n      case \"Paciente\":\n        setErrorPaciente(null);\n        break;\n      case \"Examen\":\n        setErrorExamen(null);\n        break;\n      case \"Fecha\":\n        setErrorFecha(null);\n        break;\n      default:\n        break;\n    }\n   \n  };\n\n  const deleteUrl=()=>{\n    Update.url=null\n    setUpdate(Update)\n  }\n\n  const switchPaciente =()=>{\n    switch (accion) {\n      case 'Update':\n        \n        return(\n          <Select\n          id=\"Paciente\"\n          options={pacientes}\n          defaultValue={{ value: valores.Paciente ,label: valores.Paciente+ \" - \" + valores.Nombre }}\n          onChange={handleChangeD(\"Paciente\")}\n        />\n        )\n        \n      default:\n        return(\n          <Select\n          id=\"Paciente\"\n          options={pacientes}\n          onChange={handleChangeD(\"Paciente\")}\n        />\n        );\n    }\n  }\n\n  const switchExamen =()=>{\n    switch (accion) {\n      case 'Update':\n        \n        return(\n          <Select\n          id=\"Examen\"\n          options={examenes}\n          defaultValue={{ value: valores.Examen ,label:  valores.ExaName }}\n          onChange={handleChangeD(\"Examen\")}\n        />\n        )\n        \n      default:\n        return(\n          <Select\n          id=\"Examen\"\n          options={examenes}\n          onChange={handleChangeD(\"Examen\")}\n        />\n        );\n    }\n  }\n  return (\n    <form className=\"flex flex-col  bg-white w-auto p-4 justify-between \">\n      {loading && <Loading />}\n      <label className=\"mt-4 mb-1\" htmlFor=\"Paciente\">\n        Paciente\n      </label>\n      {!loading && switchPaciente()}\n\n      <span className=\"Warring\">{errorPaciente && errorPaciente}</span>\n\n      <label className=\"mt-4 mb-1\" htmlFor=\"Examen\">\n        Examen\n      </label>\n      {!loading && switchExamen()}\n\n      <span className=\"Warring\">{errorExamen && errorExamen}</span>\n      <label className=\"mt-4 mb-1\" htmlFor=\"Archivo\">\n        Subir Pdf\n      </label>\n     \n      <div className=\"flex flex-row justify-between\">\n      \n        <input\n          onChange={handleChange}\n          type=\"file\"\n          name=\"Archivo\"\n          id=\"Archivo\"\n          accept=\"application/pdf \"\n        />\n        {  !file ? (\n          <Check size={5} color={\"gray\"} />\n        ) : (\n          <Check size={5} color={\"green\"} />\n        )}\n      </div>\n\n      <span className=\"Warring\">{errorUrl && errorUrl}</span>\n      <label className=\"mt-4 mb-1\" htmlFor=\"Fecha\">\n        Fecha\n      </label>\n      <input\n        type=\"date\"\n        name=\"Fecha\"\n        id=\"Fecha\"\n        defaultValue={Update.Fecha}\n        onChange={handleChangeD(\"Fecha\")}\n      />\n      <span className=\"Warring\">{errorFecha && errorFecha}</span>\n      <input\n        onClick={() => addRegistro()}\n        className=\"w-2/3 my-6 ml-16\"\n        type=\"button\"\n        value=\"Agregar\"\n      />\n    </form>\n  );\n};\n\nexport default AddRegistro;\n"]},"metadata":{},"sourceType":"module"}